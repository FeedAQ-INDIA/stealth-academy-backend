// Sample CourseBuilder data structure test
const sampleCourseBuilderData = {
  "orgId": null,
  "status": "DRAFT",
  "userId": 1,
  "courseId": "temp_course_id",
  "isActive": true,
  "isPublic": false,
  "metadata": {
    "isPublic": false
  },
  "courseType": "BYOC",
  "courseTitle": "Python Language Full Course (2025-26)",
  "deliveryMode": "ONLINE",
  "courseContent": [
    {
      "status": "PUBLISHED",
      "courseId": "temp_course_id",
      "metadata": {
        "videoId": "t2_Q2BRzeEE",
        "sequence": 1,
        "contentType": "YOUTUBE_VIDEO"
      },
      "createdAt": "2025-10-03T03:39:50.398Z",
      "updatedAt": "2025-10-03T08:27:25.257Z",
      "isPublished": true,
      "courseContentId": "temp_content_1",
      "courseContentType": "CourseVideo",
      "courseContentTitle": "Python Full Course❤️ | Variables & Data Types | Lecture 1",
      "courseContentCategory": "Video Content",
      "courseContentDuration": 4939,
      "courseContentSequence": 1,
      "courseContentTypeDetail": {
        "status": "PUBLISHED",
        "userId": 1,
        "courseId": "temp_course_id",
        "duration": 4939,
        "metadata": {
          "videoId": "t2_Q2BRzeEE",
          "publishedAt": "2024-01-26T15:31:21Z",
          "channelTitle": "Shradha Khapra",
          "sourcePlatform": "YOUTUBE"
        },
        "createdAt": "2025-10-03T03:39:50.398Z",
        "isPreview": false,
        "updatedAt": "2025-10-03T03:58:26.329Z",
        "thumbnailUrl": "https://i.ytimg.com/vi/t2_Q2BRzeEE/maxresdefault.jpg",
        "courseVideoId": "temp_video_1",
        "courseVideoUrl": "https://www.youtube.com/watch?v=t2_Q2BRzeEE",
        "courseContentId": "temp_content_1",
        "courseVideoTitle": "Python Full Course❤️ | Variables & Data Types | Lecture 1",
        "courseVideoDescription": "This lecture was made with a lot of love❤️"
      },
      "coursecontentIsLicensed": false
    },
    {
      "status": "DRAFT",
      "courseId": "temp_course_id",
      "metadata": {
        "sequence": 10,
        "contentType": "CourseWritten"
      },
      "createdAt": "2025-10-03T03:45:25.949Z",
      "updatedAt": "2025-10-03T08:27:25.257Z",
      "isPublished": false,
      "courseContentId": "temp_1759462962721",
      "courseContentType": "CourseWritten",
      "courseContentTitle": "OCP J 21",
      "courseContentCategory": "Written Content",
      "courseContentDuration": 300,
      "courseContentSequence": 10,
      "courseContentTypeDetail": {
        "userId": 1,
        "courseId": "temp_course_id",
        "metadata": {
          "sequence": 10,
          "contentType": "CourseWritten"
        },
        "createdAt": "2025-10-03T03:45:25.949Z",
        "updatedAt": "2025-10-03T03:58:26.329Z",
        "courseContentId": "temp_1759462962721",
        "courseWrittenTitle": "OCP J 21",
        "courseWrittenContent": "",
        "courseWrittenEmbedUrl": "https://ocpj21.javastudyguide.com/",
        "courseWrittenUrlIsEmbeddable": true
      },
      "coursecontentIsLicensed": false
    },
    {
      "isActive": true,
      "metadata": {
        "sequence": 11,
        "contentType": "CourseQuiz"
      },
      "updatedAt": "2025-10-03T08:27:25.257Z",
      "contentType": "CourseQuiz",
      "courseContentId": "temp_1759463043686",
      "courseContentType": "CourseQuiz",
      "courseContentTitle": "MID SEM QUIZ",
      "courseContentCategory": "Practice",
      "courseContentDuration": 600,
      "courseContentSequence": 11,
      "courseContentTypeDetail": {
        "metadata": {
          "maxAttempts": 3,
          "instructions": ""
        },
        "questions": [
          {
            "courseId": null,
            "metadata": {},
            "explanation": null,
            "courseQuizId": null,
            "courseContentId": null,
            "difficultyLevel": "MEDIUM",
            "questionSequence": 1,
            "quizQuestionNote": null,
            "quizQuestionType": "SINGLE_CHOICE",
            "quizQuestionTitle": "What is Python?",
            "quizQuestionOption": ["Language", "Snake", "Framework", "Database"],
            "quizQuestionNegPoint": 0,
            "quizQuestionPosPoint": 1,
            "quizQuestionCorrectAnswer": [0]
          }
        ],
        "isQuizTimed": true,
        "questionCount": 1,
        "courseQuizType": "QUIZ",
        "totalNegPoints": 0,
        "totalPosPoints": 1,
        "courseQuizTimer": 600,
        "courseQuizTitle": "MID SEM QUIZ",
        "courseQuizDescription": "Mid semester quiz for Python course",
        "courseQuizPassPercent": 70
      },
      "coursecontentIsLicensed": false
    },
    {
      "isActive": true,
      "metadata": {
        "sequence": 12,
        "contentType": "CourseFlashcard"
      },
      "updatedAt": "2025-10-03T08:27:25.257Z",
      "contentType": "CourseFlashcard",
      "courseContentId": "temp_1759463111865",
      "courseContentType": "CourseFlashcard",
      "courseContentTitle": "Python Basics Flashcards",
      "courseContentCategory": "Interactive Content",
      "courseContentDuration": 4,
      "courseContentSequence": 12,
      "courseContentTypeDetail": {
        "cards": [
          {
            "hints": ["It's a programming language"],
            "answer": "Python",
            "metadata": {},
            "question": "What is the programming language we are learning?",
            "difficulty": "EASY",
            "orderIndex": 1,
            "explanation": "Python is a high-level programming language"
          },
          {
            "hints": ["Used for storing data"],
            "answer": "Variable",
            "metadata": {},
            "question": "What stores data in Python?",
            "difficulty": "EASY",
            "orderIndex": 2,
            "explanation": "Variables are used to store data values"
          }
        ],
        "setTags": ["python", "basics"],
        "metadata": {},
        "setTitle": "Python Basics Flashcards",
        "cardCount": 2,
        "setDifficulty": "EASY",
        "setDescription": "Basic flashcards for Python programming",
        "estimatedDuration": 4
      },
      "coursecontentIsLicensed": false
    }
  ],
  "courseDuration": 32191,
  "courseImageUrl": "https://i.ytimg.com/vi/t2_Q2BRzeEE/maxresdefault.jpg",
  "courseDescription": "Python Language Full Course (2025-26)",
  "courseSourceChannel": "Shradha Khapra"
};

// Function to test the structure mapping
function testDataStructureMapping() {
  console.log("Testing CourseBuilder Data Structure Mapping...\n");
  
  // Test course level data extraction
  const {
    courseTitle,
    courseDescription,
    courseDuration = 0,
    courseImageUrl = null,
    courseType = 'BYOC',
    deliveryMode = 'ONLINE',
    courseSourceChannel = null,
    metadata = {}
  } = sampleCourseBuilderData;
  
  console.log("Course Level Data:");
  console.log(`Title: ${courseTitle}`);
  console.log(`Description: ${courseDescription}`);
  console.log(`Duration: ${courseDuration}`);
  console.log(`Type: ${courseType}`);
  console.log(`Delivery Mode: ${deliveryMode}`);
  console.log(`Source Channel: ${courseSourceChannel}\n`);
  
  // Test content processing
  const contentArray = Array.isArray(sampleCourseBuilderData.courseContent) ? sampleCourseBuilderData.courseContent : [];
  console.log(`Total Content Items: ${contentArray.length}\n`);
  
  const publishedContent = contentArray.filter(item => {
    const status = item.status || (item.isActive !== false ? 'PUBLISHED' : 'DRAFT');
    return status === 'PUBLISHED' || (item.isActive && !item.status);
  });
  
  console.log(`Content Items to be Published: ${publishedContent.length}\n`);
  
  publishedContent.forEach((item, index) => {
    console.log(`Content Item ${index + 1}:`);
    console.log(`  Title: ${item.courseContentTitle}`);
    console.log(`  Type: ${item.courseContentType}`);
    console.log(`  Sequence: ${item.courseContentSequence}`);
    console.log(`  Duration: ${item.courseContentDuration}`);
    console.log(`  Category: ${item.courseContentCategory}`);
    
    if (item.courseContentType === 'CourseVideo') {
      const video = item.courseContentTypeDetail;
      console.log(`  Video URL: ${video.courseVideoUrl}`);
      console.log(`  Thumbnail: ${video.thumbnailUrl}`);
    } else if (item.courseContentType === 'CourseWritten') {
      const written = item.courseContentTypeDetail;
      console.log(`  Embed URL: ${written.courseWrittenEmbedUrl}`);
      console.log(`  Is Embeddable: ${written.courseWrittenUrlIsEmbeddable}`);
    } else if (item.courseContentType === 'CourseQuiz') {
      const quiz = item.courseContentTypeDetail;
      console.log(`  Quiz Type: ${quiz.courseQuizType}`);
      console.log(`  Timer: ${quiz.courseQuizTimer} seconds`);
      console.log(`  Questions: ${quiz.questionCount}`);
    } else if (item.courseContentType === 'CourseFlashcard') {
      const flashcard = item.courseContentTypeDetail;
      console.log(`  Card Count: ${flashcard.cardCount}`);
      console.log(`  Difficulty: ${flashcard.setDifficulty}`);
      console.log(`  Estimated Duration: ${flashcard.estimatedDuration} minutes`);
    }
    console.log("");
  });
  
  // Summary
  const typeCounts = publishedContent.reduce((acc, item) => {
    acc[item.courseContentType] = (acc[item.courseContentType] || 0) + 1;
    return acc;
  }, {});
  
  console.log("Content Type Summary:");
  Object.entries(typeCounts).forEach(([type, count]) => {
    console.log(`  ${type}: ${count}`);
  });
}

// Function to validate required fields
function validateDataStructure() {
  console.log("\n\nValidating Data Structure...\n");
  
  // Check required course fields
  const requiredCourseFields = ['courseTitle', 'courseDescription'];
  const missingCourseFields = requiredCourseFields.filter(field => !sampleCourseBuilderData[field]);
  
  if (missingCourseFields.length > 0) {
    console.log(`❌ Missing required course fields: ${missingCourseFields.join(', ')}`);
  } else {
    console.log("✅ All required course fields present");
  }
  
  // Check content structure
  const contentArray = sampleCourseBuilderData.courseContent || [];
  let validContentCount = 0;
  let invalidContentCount = 0;
  
  contentArray.forEach((item, index) => {
    const requiredContentFields = ['courseContentTitle', 'courseContentType', 'courseContentSequence'];
    const missingContentFields = requiredContentFields.filter(field => !item[field]);
    
    if (missingContentFields.length > 0) {
      console.log(`❌ Content item ${index + 1} missing: ${missingContentFields.join(', ')}`);
      invalidContentCount++;
    } else {
      validContentCount++;
    }
  });
  
  console.log(`\n✅ Valid content items: ${validContentCount}`);
  if (invalidContentCount > 0) {
    console.log(`❌ Invalid content items: ${invalidContentCount}`);
  }
}

// Run tests
if (require.main === module) {
  testDataStructureMapping();
  validateDataStructure();
}

module.exports = { 
  sampleCourseBuilderData, 
  testDataStructureMapping, 
  validateDataStructure 
};